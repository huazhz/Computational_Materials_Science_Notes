LAMMPS教程
==========

概述
----

LAMMPS是一个跨平台的分子动力学软件，仅有CLI，一般采取“读取文件-输出结果”式的工作方式，需要其他软件进行后续处理（如使用Ovito进行分子可视化，使用gnuplot绘制数据图）。

LAMMPS的语言实际上是一种脚本语言。一般每一行为一条指令，第一个词为指令名，其后全为参数。LAMMPS会依序执行指令，直到读到 ``EOF`` 。

两种例外情况： 

1. 以 ``#`` 开头的行被视为注释
2. 在行末加 ``&`` 作为续行符

脚本结构
--------

LAMMPS输入脚本通常包含4个部分： 

1. 初始化。包含单位、维度、边界等信息，也可以包含力场参数。
2. 原子定义。
3. 设置。包含力场系数，模拟参数，输出选项等。
4. 运行模拟。使用 ``run`` 进行分子动力学模拟，使用 ``minimize`` 进行分子静力学模拟，使用 ``temper`` 进行回火模拟。
   
前三部分都可以从文件读入，后两部分根据需要可多次进行。 

变量类型
--------

1. 数字可以直接表示，字符串可以用单引号或双引号表示，也可以用三引号表示跨行字符串。
2. 使用 ``variable`` 命令声明变量，例如 ``variable x equal 2.00`` 。之后可以用 ``$x`` 引用，对于多个字母的变量，要使用 ``${my_variable}`` 的形式。
3. 对于不再使用的变量，可以用 ``variable x delete`` 释放。
4. 实际上，LAMMPS中的变量近似于宏，是纯粹的字符替换，因此即使在字符串中也可以使用变量。
5. 使用 ``$(1+2*3)`` 的形式创建匿名变量，可以将算式嵌套进其他位置。
6. 注意这种替换在下一步处理前只进行一次， 因此在 ``variable x equal 2`` 的前提下用 ``${a$x}`` 表示 ``a2`` 是不可行的， ``$($x-1)`` 同样有语法错误。可以用 ``v_x`` 表示取值，因而 ``$x-1`` 或 ``$(v_x-1)`` 都是正确的。 
7. LAMMPS已经定义了大量的预定义变量。

常用命令
--------

方括号表示可选项目

基本设置
++++++++

+-------+-----------------------+
| units | 单位                  |
+=======+=======================+
| style | 单位系统，常见的有：  |
|       |                       |
|       | - ``lj`` **默认**     |
|       | - ``metal``           |
|       | - ``si`` 国际标准单位 |
+-------+-----------------------+

+----------+------------------------+
| timestep | 仿真时间步长           |
+==========+========================+
| dt       | 步长，默认值与单位有关 |
+----------+------------------------+

原子设置
++++++++

+------------+-----------------------+
| atom_style | 原子模型              |
+============+=======================+
| style      | 原子物理模型          |
|            |                       |
|            | - ``atomic`` **默认** |
|            | - ``body`` 含有键     |
|            | - ``angle`` 键和键角  |
|            | - 等等                |
+------------+-----------------------+

+----------------+-------------------------------------------------------------+
| create_atoms   | 创建原子                                                    |
+================+=============================================================+
| type           | 原子类别（数字）                                            |
+----------------+-------------------------------------------------------------+
| style args     | 范围 参数                                                   |
|                |                                                             |
|                | - ``box`` 在整个仿真盒创建                                  |
|                | - ``region region-ID`` 在指定区域创建                       |
|                | - ``single x y z`` 创建单个原子                             |
|                | - ``random N seed region-ID`` 在指定区域随机位置创建N个原子 |
+----------------+-------------------------------------------------------------+
| [keyword args] | 其他设置 参数                                               |
+----------------+-------------------------------------------------------------+

+----------------+-------------------------------------------------------------------------+
| delete_atoms   | 删除原子                                                                |
+================+=========================================================================+
| style args     | 范围 参数                                                               |
|                |                                                                         |
|                | - ``group ID`` 删除某个组的所有原子                                     |
|                | - ``region ID`` 删除某区域内的所有原子                                  |
|                | - ``overlap length group1 group2`` 一对分别在原子组1和原子组2中的原子， |
|                |                                                                         |
|                |   相距指定距离以内则被认为重叠，删除原子组1中的那个原子                 |
+----------------+-------------------------------------------------------------------------+
| [keyword args] | 其他设置 参数                                                           |
+----------------+-------------------------------------------------------------------------+

+-------+-----------------------------------------------------------+
| mass  | 原子质量                                                  |
+=======+===========================================================+
| I     | 原子种类，可以用 ``*n`` 表示1~n，同理有 ``m*n`` ， ``n*`` |
+-------+-----------------------------------------------------------+
| value | 质量                                                      |
+-------+-----------------------------------------------------------+

+---------------+----------------------------------------------------------------------------------------------------+
| velocity      | 原子速度                                                                                           |
+===============+====================================================================================================+
| group-ID      | 要设定的原子组                                                                                     |
+---------------+----------------------------------------------------------------------------------------------------+
| style args    | 速度分布类型 参数                                                                                  |
|               |                                                                                                    |
|               | - ``creat temp seed`` 根据温度确定内能，进而随机设定速度                                           |
|               | - ``set vx vy vz`` 将所有原子的速度设为指定值                                                      |
|               | - ``scale temp`` 计算现在的温度，并按照指定温度变化原子的速度                                      |
|               | - ``ramp vdim vl vh dim l h`` 建立 `_/-` 形状的函数，把原子的 ``vdim`` 速度分量按照其 ``dim`` 坐标 |
|               |                                                                                                    |
|               |   从 ``l`` 到 ``h`` 线性地设定为 ``vl`` 到 ``vh`` 之间的值                                         |
|               | - ``zero linear/angular`` 调节原子速度，使其合计动量或合计角动量为0                                |
+---------------+----------------------------------------------------------------------------------------------------+
| [keword args] | 其他设置 参数                                                                                      |
|               |                                                                                                    |
|               | - ``dist uniform/gaussian`` 原子速度服从平均或高斯分布，仅适用于 ``creat``                         |
|               | - ``mom yes`` 所有原子合计动量为0，仅适用于 ``creat``                                              |
|               | - ``rot yes`` 所有原子合计角动量为0，仅适用于 ``creat``                                            |
|               | - ``sum yes`` 将新的速度与原有的加和而非取代                                                       |
+---------------+----------------------------------------------------------------------------------------------------+

仿真盒（simulation box）设置
++++++++++++++++++++++++++++

+----------+-----------------------------------------------------------------------+
| boundary | 仿真盒边界条件                                                        |
+==========+=======================================================================+
| x y z    | 每个方向用两个字母表示两边，相同可用一个字母                          |
|          |                                                                       |
|          | - ``p`` 周期性边界，必须同时适用于两侧                                |
|          | - ``f`` 固定边界，超出边界的原子丢失                                  |
|          | - ``s`` 收缩边界，边界浮动，为包括所有原子的盒子                      |
|          | - ``m`` 有限收缩边界，边界浮动，最小为文件或 ``creat_box`` 中的设定值 |
+----------+-----------------------------------------------------------------------+

+----------------+---------------------------------------------------------------------------------------------------------+
| lattice        | 晶格                                                                                                    |
+================+=========================================================================================================+
| style          | 晶胞类型                                                                                                |
|                |                                                                                                         |
|                | - ``none`` 无 ``custom`` 自定义                                                                         |
|                | - ``sq`` 二维简正方 ``sq2`` 二维面心正方 ``hex`` 二维六方                                               |
|                | - ``fcc`` 面心立方 ``bcc`` 体心立方 ``sc`` 简立方 ``hcp`` 六方 ``diamond`` 金刚石                       |
+----------------+---------------------------------------------------------------------------------------------------------+
| scale          | 空间基矢长度                                                                                            |
|                |                                                                                                         |
|                | - 对于 ``sq,sq2,cs,fcc,bcc`` ，即晶格常数                                                               |
|                | - 对于 ``hex`` ， :math:`\vec{a}=(1\ 0\ 0),\vec{b}=(0\ \sqrt{3}\ 0)` ，                                 |
|                |                                                                                                         |
|                |   对于 ``hcp`` ， :math:`\vec{a}=(1\ 0\ 0),\vec{b}=(0\ \sqrt{3}\ 0),\vec{c}=(0\ 0\ \sqrt{\frac{8}{3}})` |
+----------------+---------------------------------------------------------------------------------------------------------+
| [keyword args] | 其他设置 参数                                                                                           |
+----------------+---------------------------------------------------------------------------------------------------------+

+----------------+--------------------------------------------------------------------+
| region         | 区域                                                               |
+================+====================================================================+
| ID             | 区域名称                                                           |
+----------------+--------------------------------------------------------------------+
| style args     | 区域类型                                                           |
|                |                                                                    |
|                | - ``delate`` 删除区域                                              |
|                | - ``block xl xh yl yh zl zh`` 方形区域及其范围（以晶格常数为单位） |
|                | - ``sphere x y z r`` 球体区域及其球心坐标、半径                    |
|                | - ``union N ID1 ID2 ……`` 合成多个区域，N为数目，之后为各区域名称   |
|                | - 此外还有圆锥、圆柱、平面等等                                     |
+----------------+--------------------------------------------------------------------+
| [keyword args] | 其他设置 参数                                                      |
|                |                                                                    |
|                | - ``side out`` 取描述之外侧区域                                    |
|                | - ``unit box`` 以仿真盒基矢为单位                                  |
|                | - 还有 ``move`` 和 ``rotate`` 实现平移和旋转                       |
+----------------+--------------------------------------------------------------------+

+----------------+------------------------+
| create_box     | 创建仿真盒             |
+================+========================+
| N              | 模拟中用到的原子种类数 |
+----------------+------------------------+
| region-ID      | 建立仿真盒的区域名称   |
+----------------+------------------------+
| [keyword args] | 其他设置 参数          |
+----------------+------------------------+

+------------+------------------------------------------------------------------------------------------+
| group      | 原子组                                                                                   |
+============+==========================================================================================+
| ID         | 原子组名称                                                                               |
+------------+------------------------------------------------------------------------------------------+
| style args | 分组方式 参数                                                                            |
|            |                                                                                          |
|            | - ``delete`` 删除原子组                                                                  |
|            | - ``clear`` 清空原子组                                                                   |
|            | - ``empty`` 建立空原子组                                                                 |
|            | - ``region region-ID`` 将区域中的原子建立原子组                                          |
|            | - ``type`` 或 ``id`` 或 ``molecule`` 根据原子类别/ID/分子确定原子分组，                  |
|            |                                                                                          |
|            |   可以用 ``id 10 20`` 式的列表，也可以用数列 ``id 10:100:5`` ，或者逻辑判断 ``id <= 10`` |
|            | - ``union args`` 用多个原子组合成一个原子组                                              |
|            | - 还可以使用 ``variable`` 等等来确定原子分组                                             |
+------------+------------------------------------------------------------------------------------------+

相互作用
++++++++

+------------+---------------------------------------------+
| pair_style | 原子互作用模型                              |
+============+=============================================+
| style args | 模型 参数，种类极其繁多，常见的有           |
|            |                                             |
|            | - ``lj/`` 系列，基于L-J势能曲线             |
|            | - ``eam/`` 系列，基于嵌入原子理论的多体作用 |
+------------+---------------------------------------------+

+------------+---------------------------------------------------+
| pair_coeff | 原子互作用参数                                    |
+============+===================================================+
| I J        | 互作用的原子类别，也可以包含 ``*`` ，需要满足I<=J |
+------------+---------------------------------------------------+
| args       | 互作用参数，取决于模型，可以利用LAMMPS中已有数据  |
+------------+---------------------------------------------------+

I/O
+++

+----------+-----------------------------------------------------------------+
| dump     | 输出                                                            |
+==========+=================================================================+
| ID       | 用户定义名                                                      |
+----------+-----------------------------------------------------------------+
| group-ID | 要输出的原子组，可以是 ``all``                                  |
+----------+-----------------------------------------------------------------+
| style    | 输出类型，例如 ``atom, cfg, image, movie, vtk`` ，参见 输出解读 |
+----------+-----------------------------------------------------------------+
| N        | 每几个时间步长输出一次                                          |
+----------+-----------------------------------------------------------------+
| file     | 输出文件名，可以包含一个 ``*`` 以自动顺序命名                   |
+----------+-----------------------------------------------------------------+
| [args]   | 每个原子要输出的变量列表                                        |
+----------+-----------------------------------------------------------------+

+--------------+------------------------------------+
| dump_modify  | 修改输出设置                       |
+==============+====================================+
| dump-ID      | 要修改的输出                       |
+--------------+------------------------------------+
| keyword args | 要修改的项目 参数                  |
|              |                                    |
|              | - ``every steps`` 修改输出频率     |
|              | - 很多项目类似于 ``dump`` 中的设置 |
+--------------+------------------------------------+

+--------+--------------------------------------------------+
| thermo | 输出热力学信息                                   |
+========+==================================================+
| N      | 每几个时间步长输出一次，                         |
|        |                                                  |
|        | 可以是 ``v_x`` 的形式，其中 ``x`` 为数组型的变量 |
+--------+--------------------------------------------------+

+----------------+--------------------------------------+
| print          | 打印（到屏幕和log）                  |
+================+======================================+
| string         | 输出的字符串                         |
+----------------+--------------------------------------+
| [keyword args] | 输出设置 参数                        |
|                |                                      |
|                | - ``file name`` 输出至文件（覆盖）   |
|                | - ``append name`` 输出至文件（追加） |
|                | - ``screen yes/no`` 是否输出到屏幕   |
+----------------+--------------------------------------+

仿真运算
++++++++

+------------+----------------------------------------------------------------------------------------------------------+
| fix        | 修正，在每个时间步中应用于系统的操作                                                                     |
+============+==========================================================================================================+
| ID         | 用户定义名                                                                                               |
+------------+----------------------------------------------------------------------------------------------------------+
| group-ID   | 进行修正的原子组                                                                                         |
+------------+----------------------------------------------------------------------------------------------------------+
| style args | 操作 参数，多种多样，定义后就会执行，直到使用 ``unfix``                                                  |
|            |                                                                                                          |
|            | - ``print N string keyword args`` 每N个时间步长打印一次文本                                              |
|            | - ``nvt temp Tstart Tstop Tdamp`` 按照正则系综调整原子的位置动量，注意这里的 ``nvt temp`` 整体作为操作名 |
+------------+----------------------------------------------------------------------------------------------------------+

+----------------+--------------------------------------------------------+
| run            | 运行仿真                                               |
+================+========================================================+
| N              | 运行的步长数                                           |
+----------------+--------------------------------------------------------+
| [keyword args] | 其他设置 参数                                          |   
|                |                                                        |
|                | - ``strat N`` 起始于第N个时间步                        |
|                | - ``stop N`` 终止于第N个时间步                         |
|                | - ``every M c1 c2 ……`` 每M个时间步执行一次命令c1,c2 …… |
+----------------+--------------------------------------------------------+

+------------+------------------------------------------------------------------+
| compute    | 计算                                                             |
+============+==================================================================+
| ID         | 用户定义名                                                       |
+------------+------------------------------------------------------------------+
| group-ID   | 进行运算的原子组                                                 |
+------------+------------------------------------------------------------------+
| style args | 运算项目 参数，类似 ``fix`` ，多种多样                           |
|            |                                                                  |
|            | - ``pe`` 整个体系的势能                                          |
|            | - ``pe/atom`` 平均每个原子的势能                                 |
|            | - ``temp`` 用 :math:`\frac{\mathrm{dim}}{2}N k_B T` 计算系统温度 |
|            | - ``ke`` 用 :math:`\sum \frac{1}{2}mv^2` 计算整个体系的动能      |
|            | - ``ke/atom`` 平均每个原子的动能                                 |
+------------+------------------------------------------------------------------+

+-----------+-------------------------------------------------------+
| min_style | 能量最小化算法                                        |
+===========+=======================================================+
| style     | 算法                                                  |
|           |                                                       |
|           | - ``cg`` 共轭梯度算法的一种， **默认**                |
|           | - ``hftn`` 牛顿法的一种，在 ``cg`` 表现不佳时可替代   |
|           | - ``sd`` 最陡峭下降算法，收敛较慢但某些情况下较为稳健 |
+-----------+-------------------------------------------------------+

+----------+-----------------------------------------------------------------+
| minimize | 能量最小化（会调节原子坐标，但是原子都是0K静止的，与运动无关）  |
+==========+================+================================================+
| etol     | 迭代停止条件， | 可接受的相邻两次迭代能量差（比例形式，无单位） |
+----------+                +------------------------------------------------+
| ftol     |                | 可接受的最终每个粒子在任意方向的最大受力       |
+----------+ 满足一条即停   +------------------------------------------------+
| maxiter  |                | 最大迭代次数                                   |
+----------+                +------------------------------------------------+
| maxeval  |                | 最大力/能量计算次数                            |
+----------+----------------+------------------------------------------------+


程序控制
++++++++

+------------+----------------------------------------------------------------+
| variable   | 声明                                                           |
+============+================================================================+
| name       | 变量名                                                         |
+------------+----------------------------------------------------------------+
| style args | 类别 参数                                                      |
|            |                                                                |
|            | - ``delete`` 删除变量                                          |
|            | - ``equal expression`` 最常见的数值赋值                        |
|            | - ``string something`` 字符串                                  |
|            | - ``loop N1 N2 [pad]`` 从N1到N2的整数迭代器，省略N1则从1开始， |
|            |                                                                |
|            |   若有 ``pad`` ，迭代数值在形式上总会保持位数相同              |
|            | - ``file name`` 导入文件                                       |
+------------+----------------------------------------------------------------+

+----------------------+------------------------+
| if                   | 判断语句               |
+======================+========================+
| bollen               | 可解析为布尔量的表达式 |
+----------------------+------------------------+
| then c1 c2 ……        | 然后运行的命令         |
+----------------------+                        |
| elif bollen d1 d2 …… |                        |
+----------------------+                        |
| else e1 e2 ……        |                        |
+----------------------+------------------------+

+-------+----------+
| label | 标签     |
+=======+==========+
| ID    | 标签名称 |
+-------+----------+

+----------+-----------------------------------------+
| jump     | 跳转至行                                |
+==========+=========================================+
| file     | 目标文件                                |
+----------+-----------------------------------------+
| label-ID | 目标标签，配合 ``label`` 使用可产生循环 |
+----------+-----------------------------------------+

+-----------+----------------------+
| next      | 值迭代，一般用于循环 |
+===========+======================+
| variables | 若干个迭代器变量     |
+-----------+----------------------+

+--------+----------------------------+
| clear  | 重置仿真系统，清除所有数据 |
+========+============================+
| 无参数 |                            |
+--------+----------------------------+

+----------+---------------+
| shell    | 调用bash      |
+==========+===============+
| cmd args | bash命令 参数 |
+----------+---------------+

+----------+-----------------------+
| quit     | 退出                  |
+==========+=======================+
| [status] | 退出状态，0为正常退出 |
+----------+-----------------------+

